# Board Service

읽기 트래픽이 집중되는 게시판 도메인을 담당하는 서비스입니다.  
게시글 생성과 조회를 담당하며, 이벤트 기반 아키텍처의 중심 역할을 수행합니다.

---

## 1. 역할 (Responsibility)

- 게시글 생성
- 게시글 조회 (고트래픽 구간)
- 게시글 생성 이벤트 발행
- 사용자 정보 Read Model 유지

---

## 2. 설계 의도

Board Service는 조회 트래픽이 집중되는 서비스로 가정했습니다.

따라서 다음을 목표로 설계했습니다:

- 읽기 성능 최적화
- 서비스 간 결합도 최소화
- 동기 호출 최소화
- 이벤트 기반 확장성 확보

---

## 3. 게시글 작성 흐름 (Saga Pattern)

게시글 작성은 여러 서비스의 상태 변경을 포함하므로 Saga 패턴을 적용했습니다.

### 처리 순서

1. Point Service 동기 호출 → 포인트 차감
2. 게시글 DB 저장
3. `board.created` 이벤트 발행
4. User Service가 이벤트를 소비하여 활동 점수 적립 (비동기)

### 설계 판단

- 포인트 차감은 선행 조건이므로 동기 처리
- 활동 점수 적립은 즉시 반영이 필요하지 않아 비동기 처리
- 사용자 경험과 정합성 요구 수준을 기준으로 동기/비동기를 구분

---

## 4. 이벤트 발행

### Topic

`board.created`

### 이벤트 목적

- 사용자 활동 점수 반영
- 다른 서비스 확장 가능성 확보
- 서비스 간 직접 호출 제거

Kafka는 at-least-once 전달 모델이므로 중복 소비 가능성이 존재합니다.

운영 환경에서는 이벤트 ID 기반 멱등성 보장 전략을 적용할 수 있습니다.

---

## 5. 사용자 정보 Read Model

Board Service는 User Service DB에 직접 접근하지 않습니다.

회원가입 시 발행되는 `user.signed-up` 이벤트를 구독하여  
조회에 필요한 사용자 정보를 내부 테이블에 저장합니다.

이를 통해:

- 조회 시 User Service 네트워크 호출 제거
- 서비스 간 결합도 감소
- 읽기 성능 향상

---

## 6. 캐시 전략 (Redis)

게시글 목록 조회는 Redis 캐시를 적용했습니다.

```java
@Cacheable(cacheNames = "getBoards")
```

### TTL 전략
- TTL: 1분
- 게시글 목록은 실시간 반영이 필수적이지 않다고 판단
- TTL 기반 eventual consistency 모델 채택

즉, 게시글 작성 직후 1분 이내에는 목록에 반영되지 않을 수 있습니다.

트래픽 분산을 우선 고려한 설계입니다.

---

## 7. 동시성 제어 전략 (Point 차감 관련)

게시글 작성 시 포인트 차감은 동시성 이슈가 발생할 수 있습니다.

예:
- 동시에 두 요청이 들어올 경우 Lost Update 문제 발생 가능

이를 방지하기 위해 Optimistic Lock(@Version)을 적용하여
버전 기반 동시성 제어가 가능하도록 설계했습니다.

충돌 발생 시 재시도 전략으로 정합성을 보장할 수 있습니다.

---

## 8. 내부 통신 원칙
- 서비스 간 DB 직접 접근 금지
- 동기 호출 최소화
- 상태 변경은 이벤트 기반 처리 우선
- 서비스 책임 명확화

---

## 9. 기술 스택
- Spring Boot
- Spring Data JPA
- Redis (ElastiCache)
- Kafka (MSK)
- MySQL (RDS)

---

## 10. 실행 방법 (Local)
```bash
docker-compose up -d
```

---

## 11. 핵심 설계 요약
- 읽기 트래픽 집중 서비스로 가정
- Redis 기반 조회 최적화
- Saga 패턴 기반 분산 상태 변경 처리
- 이벤트 기반 서비스 확장성 확보
- 멱등성 및 동시성 문제 고려 설계
